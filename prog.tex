\chapter{Программа}\label{ch:programm}

Во время работы были написаны программа на языке Python, реализующая рассчёты по методу <<крест-колокол>>.
Она состоит из следующих модулей
\begin{enumerate}
    \item config - чтение конфигурационных файлов для задач
    \item mesher - генерации рассчётной сетки для системы
    \item solver - рассчёта деформаций и разрыва тканного композита
    \item writer - запись результатов в формат .vtu (VTK Unstructured Grid)
\end{enumerate}
Далее подробно рассмотрим каждый модуль.

\section{Config}\label{sec:prog-config}
Config - модуль, отвечающий за чтение списка задач для программы.

Конфиг представляет собой список задач (tasks) и директорию, для записи результатов (out\_dir).
Каждый task имеет вид:
\begin{minted}{yaml}
name: simple # название таска, результат будет иметь вид: ${name}.vtu
    mesh:
        resolution: 100 # Разрешение нитей, точек/см
        diameter: 0.5 # толщина нити, см
        width: 20 # Ширина куска = длина ниток утка
        weft_density: 1 # Плотность ниток утка, нитей / см
        length: 50 # Длина куска = длина ниток основы
        warp_density: 0.5 # Плотность ниток основы, нитей / см
    solver:
        n_steps: 250 # Число шагов
        step: 0.1 # размер шага
\end{minted}

Конфиг поддерживает шаблоны jinja2 для быстрой генерации параметризованных задач.

Пример полного конфига
\begin{minted}{yaml}
---
out_dir: out

tasks:
  - name: simple
    mesh:
      resolution: 1
      diameter: 0.001
      width: 100
      weft_density: 1
      length: 100
      warp_density: 1
    solver:
      step: 0.1
      n_steps: 250
  {% for step in [0.1, 0.05, 0.02] %}
  - name: "step-{{ step }}"
    mesh:
      resolution: 1
      diameter: 0.001
      width: 100
      weft_density: 1
      length: 100
      warp_density: 1
    solver:
      step: !!float "{{ step }}"
      n_steps: !!int "{{ (25/step)|round|int }}"
  {% endfor %}
\end{minted}
